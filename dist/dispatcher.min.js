angular.module("dispatcher",[]).service("dispatcher",function(r){var t,e,n,i,o,a,c,s,h;return h={},i={},o={},a=1,n=!1,s="ID_",e=[],t=null,c=null,{invoke:function(r){var e,n;o[r]=!0;try{h[r](t,c)}catch(n){e=n,console.error(e)}return i[r]=!0},register:function(r,t){if(t||(t=""+s+a++),t in h)throw new Error("dispatcher.register(...): a store is already registered under "+t+".");return h[t]=r,t},waitFor:function(r){var t,e,i,a;if(!n)throw new Error("dispatcher.waitFor(...): must be called only while dispatching.");for(_.isArray(r)||(r=[r]),i=[],t=0,e=r.length;e>t;t++){if(a=r[t],o[a])throw new Error("dispatcher.waitFor(...): circular dependency detected while waiting for "+a);i.push(this.invoke(a))}return i},replay:function(r){var t,e,n,i;for(i=[],t=0,e=r.length;e>t;t++)n=r[t],i.push(this.dispatch(n.action,n.payload));return i},unregister:function(r){if(!(r in h))throw new Error("dispatcher.unregister(...): "+r+" is not a registered.");return delete h[r]},dispatch:function(t,i){var a,c;if(window.__DEV__&&(console.debug("Dispatch: "+t.name,i),r.check(i,t.schema),e.push({action:t,payload:i})),n)throw new Error("dispatcher.dispacth(...): Cannot dispacth while dispatching");this.startDispatching(t,i);for(c in h)a=h[c],o[c]||this.invoke(c);return this.stopDispatching()},isDispatching:function(){return n},startDispatching:function(r,t){var e,a,c;n=!0,r=r,t=t,a=[];for(c in h)e=h[c],i[c]=!1,a.push(o[c]=!1);return a},stopDispatching:function(){return n=!1,t=null,c=null}}}),angular.module("dispatcher").service("dataContract",function(){return{check:function(r,t){var e,n,i,o;if(!_.isString(t)){i=[];for(e in t)if(n=t[e],_.isArray(n)){if(!_.isArray(r[e]))throw console.error("Contract breach: "+e+": ",r[e]),Error("Contract breach: expect '"+e+"' ("+n+") to be an array, instead found "+typeof r[e]);i.push(function(){var t,i,a,c;for(a=r[e],c=[],t=0,i=a.length;i>t;t++)o=a[t],c.push(this.check(o,n[0]));return c}.call(this))}else if(_.isObject(n))i.push(this.check(r[e],n));else{if(r[e]&&typeof r[e]!==n)throw console.error("Contract breach: "+e+": ",r[e]),Error("Contract breach: expect '"+e+"' ("+r[e]+") to be a "+n+", instead found "+typeof r[e]);i.push(void 0)}return i}if(typeof r!==t)throw console.error("Contract breach: "+r+": ",r),Error("Contract breach: expect "+r+" to be of type "+t+", instead found "+typeof r)}}});