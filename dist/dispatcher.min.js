angular.module("dispatcher",[]).service("dispatcher",function(t){var i;return this.registry={},this.isHandled={},this.isPending={},this.lastID=1,this.isDispatching=!1,this.prefix="ID_",this.dispatcher_logs=[],i=function(t){var i,r;this.isPending[t]=!0;try{this.registry[t](this.action,this.payload)}catch(r){i=r,console.error(i)}return this.isHandled[t]=!0},{register:function(t,i){if(i in this.registry)throw new Error("dispatcher.register(...): a store is already registered under "+i+".");return i||(i=""+_prefix+this.lastID++),this.registry[i]=t,i},waitFor:function(t){var r,e,s,n;if(!this.isDispatching)throw new Error("dispatcher.waitFor(...): must be called only while dispatching.");for(_.isArray(t)||(t=[t]),s=[],r=0,e=t.length;e>r;r++){if(n=t[r],this.isPending[n])throw new Error("dispatcher.waitFor(...): circular dependency detected while waiting for "+n);s.push(i(n))}return s},replay:function(t){var i,r,e,s;for(s=[],i=0,r=t.length;r>i;i++)e=t[i],s.push(this.dispatch(e.action,e.payload));return s},unregister:function(t){if(!(t in this.registry))throw new Error("dispatcher.unregister(...): "+t+" is not a registered.");return delete this.registry[t]},dispatch:function(i,r){var e,s,n,h;if(window.__DEV__&&(console.debug("Dispatch: "+i.name,r),t.check(r,i.schema),this.dispatcher_logs.push({action:i,payload:r})),this.isDispatching)throw new Error("dispatcher.dispacth(...): Cannot dispacth while dispatching");for(this.startDispatching(i,r),n=this.registry,e=0,s=n.length;s>e;e++)h=n[e],this.isPending[h]||this.invoke(h);return this.stopDispatching()},isDispatching:function(){return this.isDispatching},startDispatching:function(t,i){var r,e,s,n,h;for(this.isDispatching=!0,this.action=t,this.payload=i,s=this.registry,n=[],r=0,e=s.length;e>r;r++)h=s[r],this.isHandled[h]=!1,n.push(this.isPending[h]=!1);return n},stopDispatching:function(){return this.isDispatching=!1,this.action=null,this.payload=null}}}),angular.module("dispatcher").service("dataContract",function(){return{check:function(t,i){var r,e,s,n;if(!_.isString(i)){s=[];for(r in i)if(e=i[r],_.isArray(e)){if(!_.isArray(t[r]))throw console.error("Contract breach: "+r+": ",t[r]),Error("Contract breach: expect '"+r+"' ("+e+") to be an array, instead found "+typeof t[r]);s.push(function(){var i,s,h,a;for(h=t[r],a=[],i=0,s=h.length;s>i;i++)n=h[i],a.push(this.check(n,e[0]));return a}.call(this))}else if(_.isObject(e))s.push(this.check(t[r],e));else{if(t[r]&&typeof t[r]!==e)throw console.error("Contract breach: "+r+": ",t[r]),Error("Contract breach: expect '"+r+"' ("+t[r]+") to be a "+e+", instead found "+typeof t[r]);s.push(void 0)}return s}if(typeof t!==i)throw console.error("Contract breach: "+t+": ",t),Error("Contract breach: expect "+t+" to be of type "+i+", instead found "+typeof t)}}});